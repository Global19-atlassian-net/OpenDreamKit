\documentclass{deliverablereport}

\usepackage[style=alphabetic,backend=bibtex]{biblatex}
\usepackage{wrapfig}
\addbibresource{../../lib/kbibs/kwarcpubs.bib}
\addbibresource{../../lib/kbibs/extpubs.bib}
\addbibresource{../../lib/kbibs/kwarccrossrefs.bib}
\addbibresource{../../lib/kbibs/extcrossrefs.bib}
\addbibresource{../../lib/deliverables.bib}
%\addbibresource{../../lib/publications.bib}
\addbibresource{rest.bib}
% temporary fix due to http://tex.stackexchange.com/questions/311426/bibliography-error-use-of-blxbblverbaddi-doesnt-match-its-definition-ve
\makeatletter\def\blx@maxline{77}\makeatother

\deliverable{UI}{jupyter-test}
\deliverydate{02/27/2017}
\duedate{02/27/2017 (Month 18)}
\def\pn{OpenDreamKit}
\author{Martin Sandve Aln\ae{}s \& Hans Fangohr \& Vidar Fauske \& Thomas Kluyver \& Benjamin Ragan-Kelley \& MORE?}

\begin{document}
\maketitle
%\input{abstract}
\strut\githubissuedescription
\newpage\tableofcontents\newpage

\newcommand{\nbval}{\texttt{nbval} }

\section{Background} % (fold)

\subsection{Jupyter notebook}
The Jupyter Notebook is a web application that enables the creation
and sharing of executable documents that contain live code,
equations, visualizations and explanatory text.


% \begin{wrapfigure}{r}{1.0\textwidth}
\begin{figure}
\centerline{\includegraphics[width=0.7\textwidth]{img/jupyterdemo-largefont.pdf}}
\caption{\label{fig:jupyterdemo} Self-contained \Jupyter Notebook
  demonstrating the concepts of cells that contain different types of
  material and can be executed (or updated) in arbitrary or sequential
  order.}
\end{figure}
%\end{wrapfigure}

Thanks to a modular design, Jupyter notebooks can be used with any
computational system that provides a so-called Jupyter kernel
implementing the Jupyter messaging protocol to communicate with the
notebook. OpenDreamKit therefore promotes the Jupyter notebook as user
interface of choice, in particular since it is particularly suitable
for building modular web based Virtual Research Environments.

An example Jupyter notebook (using a Python kernel) is shown in
figure~\ref{fig:jupyterdemo}. Once the calculation, exploration and
annotation is completed, the document can be saved to disk as a (json)
file. This notebook can be opened again later at the same or different
computers, and will display input and output data as visible in the
figure. Furthermore, if a Python kernel is installed, the notebook can
be executed again  - thus providing an executable document, that
can integrate text, equations, code, output from the code, and graphs and
other multimedia objects.

The very nature of the notebook enables and encourages reproducible
science, contributing to our overall ambition of enabling better
science through better electronic infrastructure: researchers can
carry out a computation within the notebook, and all steps are
automatically recorded and can be saved at the press of a
button. While some editing (and maybe removing avenues of
computational exploration that were unsuccessful from the notebook) is
necessary before the notebook can be shared with others effectively,
this is still a significant advancement over managing snippets of
code, post processing scripts, figures and (latex) manuscripts in
different files and with no explicitly documented dependency.

We see Jupyter notebooks being used in a number of use cases, including
\begin{itemize}
\item computational exploration
\item documentation of software packages
\item tutorials for software
\item teaching materials in higher education
\end{itemize}

In this deliverable, we enrich the ecosystem of Jupyter notebook tools
with the NoteBook VALidation tool (NBVAL), that allows to check the
types of documents listed above \emph{automatically} for they validity.

\section{Validation} % (fold)

Jupyter notebook documents have become an important part of the
development and communication of computational ideas.  While these
documents contain code and the output produced by running that code,
they do not guarantee that the code remains valid in changing
circumstances or that it continues to function after updates to
underlying packages.  These are common problems in all software, but
existing testing frameworks do not support notebooks.  Further,
Jupyter notebooks aim to be a tool for enabling reproducible
computation and communication, and the ability to validate and verify
the contents of notebooks is critical to that goal.  For these
reasons, it is important that notebooks can be tested efficiently, so
that authors and readers alike can verify that the notebooks contents
remain valid.



The nature of notebooks presents different opportunities and
challenges from conventional code testing.  Notebooks are narrative
documents, and their code is often not arranged in functions and
classes, which normally form the units of code to be tested.  However,
because outputs are stored in the notebook, output from running the
code can be compared against previously saved output.

\section{Validating notebooks with \nbval} % (fold)

\begin{figure}[ht]
  \centering
  \includegraphics[width=.7\textwidth]{img/nbval-terminal}
  \caption{\nbval output, showing that output changed.}\label{fig:nbval}
\end{figure}

\nbval (\url{https://github.com/computationalmodelling/nbval}) is a
new tool for testing notebooks, built as a plugin for the pytest
testing framework (\url{http://pytest.org}).  By leveraging existing
tools, \nbval fits well into the software development tools such as
continuous integration services and testing environments.

When \nbval encounters a notebook to test, it identifies the language
of the notebook from the notebook's metadata and starts a process to
run the code found in notebook, called the Kernel.  \nbval
communicates with this Kernel via the Jupyter protocol, as in the
notebook environment.  Each cell in a notebook constitutes a test, and
is executed in order, as if the notebook had been executed in the
interactive notebook environment.

Unlike traditional source code files, notebooks contain both code to
execute and the output.  Validating notebooks can take the output into
account or not.  At its most basic level, called `lax mode', \nbval
executes a cell, only checking for errors.  This verifies that
execution of a notebook completes without error, but makes no effort
to guarantee that the result is the same across executions.

\nbval's default mode is to record the output produced by executing
the notebook, and compare it with the output stored in the notebook.
At its strictest, any visible change in the output will result in a
failed test.  Many times, output can contain transient values that are
not informative, such as memory addresses or dates.  To deal with
this, \nbval provides an extensible mechanism for normalizing output,
so that these transient values may be excluded from the comparison.

The output checking in \nbval may be controlled on a cell-by-cell
basis: notebook authors may either start with no output checking (`lax
mode') and mark specific cells whose output should be checked, or
start with full output checking and mark cells whose output should be
ignored.  The author indicate that nbval should not execute a cell at
all, or that it an error is the expected result of a cell.

\section{nbval and reproducibility} % (fold)

\nbval facilitates integrating notebooks into a reproducible
scientific workflow.  Tests are integral to maintaining and verifying
software, which is critical for validating and reproducing scientific
computation.  A publication can include a notebook that produces its
results or figures.  By using \nbval, the validation of this notebook
and output can be automated, to make it more convenient, and thus more
likely, for scientific publications to follow reproducible practices.


\section{nbval and nbdime} % (fold)

Testing notebooks with \nbval involves comparing the notebook as saved,
and the notebook recently run.
This is comparing two notebooks,
which can build on earlier OpenDreamKit work.
\nbval can use nbdime, produced in \delivref{UI}{jupyter-collab},
to display the difference between the before and after notebooks,
for more effective comparison and identification of changes.

\begin{figure}[ht]
  \centering
  \includegraphics[width=.7\textwidth]{img/nbval-nbdime}
  \caption{An \nbval output rendered with nbdime}\label{fig:nbval-nbdime}
\end{figure}

\section{Future work} % (fold)

\nbval has been integrated successfully into some repositories of
notebook-based educational materials and software documentation by
OpenDreamKit participants, and is being integrated into the existing
notebook-based documentation of projects in the wider Jupyter
community.  We will work to encourage adoption of \nbval for verifying
documentation, and would like to see nbval used to enable verification
of scientific publications now that it has proved its effectiveness in
educational materials.

\printbibliography
\end{document}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: t
%%% End:

%  LocalWords:  githubissuedescription newpage tableofcontents newpage printbibliography
