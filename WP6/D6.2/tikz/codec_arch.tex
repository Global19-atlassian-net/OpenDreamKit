\documentclass{standalone}
\usepackage{../lstjson}
\usepackage{../lstmmt}
\usepackage{tikz}
\usetikzlibrary{backgrounds,shapes,fit,shadows,arrows,shapes.geometric}
\makeatletter\input{../../CICM2016/tikz/pgflibrarytikzmmt.code.tex}\makeatother

\begin{document}
\def\thmo#1#2{\mathsf{#1}\colon\kern-.15em{#2}}
\providecommand\myxscale{2.6}
\providecommand\myyscale{1.2}
\providecommand\myfontsize{\footnotesize}
\lstset{language=MMT,mathescape}

\setbox0\hbox{\myfontsize
\begin{lstlisting}[linewidth=.3\textwidth]
conductor: int $\US$
 ?codec standardInt $\US$
 ?implements cond
 $\RS$
$\dots$
\end{lstlisting}
  }

\setbox1\hbox{\myfontsize
\begin{lstlisting}[linewidth=.4\textwidth]
elliptic\_curve: type $\RS$
cond: elliptic\_curve $\rightarrow$ int $\RS$
$\dots$
\end{lstlisting}
  }

  \setbox2\hbox{\myfontsize
\begin{lstlisting}[linewidth=.4\textwidth]
11a1: elliptic_curve $\US$ = $\dots$ $\RS$
$\dots$
\end{lstlisting}
  }

\begin{tikzpicture}[xscale=\myxscale,yscale=\myyscale]\myfontsize
  \tikzstyle{database}=[cylinder,shape border rotate=90,aspect=0.25,draw,cylinder uses custom fill,cylinder body fill=white!30,cylinder end fill=white!3]
  \node[database] (db) at (1,4) {
    \begin{tabular}{c}Database\\\\ LMFDB\\ (MongoDB)\end{tabular}
  };

  \node[draw] (record) at (2.5,4) {
    \begin{minipage}{3cm}
\begin{lstlisting}[language=json,mathescape,frame=none,aboveskip=2pt,belowskip=2pt]
label: "11a1",
conductor: 5,
$\dots$
\end{lstlisting}
\end{minipage}};

  \draw[->] (db) -- node[above]{contains} (record);

  \node[thy] (schema) at (2.5,2) {$\mmtthy{Record Schema Theory}{\box0}{}$};
  \draw[->] (schema) -- node[left]{describes} (record);

  \node[thy] (mitm) at (0,2) {$\mmtthy{Math-In-The-Middle Theory}{\box1}{}$};

  \draw[view] (schema) -- node[above]{implements} (mitm);

  \node[thy] (virtual) at (1,0) {$\mmtthy{Virtual Theory}{\box2}{}$};

  \draw[includeleft] (virtual) -- node[left]{includes} (mitm);
\end{tikzpicture}
\end{document}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: t
%%% End:
