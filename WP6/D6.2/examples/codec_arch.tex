\def\thmo#1#2{\mathsf{#1}\colon\kern-.15em{#2}}
\providecommand\myxscale{3.9}
\providecommand\myyscale{2.2}
\providecommand\myfontsize{\footnotesize}

\begin{figure}[h]
  \begin{center}
    \begin{tikzpicture}[xscale=\myxscale,yscale=\myyscale]\myfontsize

    \tikzstyle{database}=[cylinder,shape border rotate=90,aspect=0.25,draw,cylinder uses custom fill,cylinder body fill=white!30,cylinder end fill=white!3]

    \node[database] (db) at (1,4) {
      \begin{tabular}{c}Database\\\\ LMFDB\\ (MongoDB)\end{tabular}
    };

    \node[draw] (record) at (2.5,4) {
    \begin{lstlisting}[
      language=json,
      frame=none,
      backgroundcolor=\color{white},
      escapechar=!,
      linewidth=0.21\textwidth
    ]
{
  label: "11a1",
  conductor: 5,
  !$\dots$!
}
    \end{lstlisting}
       };

      \draw[->] (db) -- node[above]{contains} (record);

      \node[thy] (schema) at (2.5,2) {
        \begin{tabular}{l}
          \textsf{Record Schema Theory}\\\hline
          \texttt{conductor: int} $\US$\\
            \texttt{  ?codec standardInt} $\US$\\
            \texttt{  ?implements cond}\\
          $\RS$\\
          $\dots$
        \end{tabular}

      };

      \draw[->] (schema) -- node[above]{describes} (record);

      \node[thy] (mitm) at (0,2) {
        \begin{tabular}{l}
          \textsf{Math-In-The-Middle Theory}\\\hline
          \texttt{elliptic\_curve: type} $\RS$\\
          \texttt{cond: elliptic\_curve $\rightarrow$ int} $\RS$\\
          $\dots$
        \end{tabular}
      };

      \draw[->] (schema) -- node[above]{implements} (mitm);

      \node[thy] (virtual) at (1,0) {
        \begin{tabular}{l}
          \textsf{Virtual Theory}\\\hline
          \texttt{11a1: elliptic\_curve $\US$ = $\dots$} $\RS$\\
          $\dots$
        \end{tabular}
      };

      \draw[include] (virtual) -- node[above]{includes} (mitm);

    \end{tikzpicture}
  \end{center}

  \caption[Translation between Database and Mathematical Objects]{
    Illustration of the method we developed to translate between database objects and mathematical objects.
    As an example we use Elliptic Curves from \LMFDB.
  }
  \label{fig:codec_arch}
\end{figure}
