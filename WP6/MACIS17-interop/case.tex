\begin{figure}[ht]\centering\vspace*{-1em}
  \tikzinput{gap_singular_mitm_fig}
  \caption{MitM Interaction in Jane's Use Case}\label{fig:mitmpoc}\vspace*{-1em}
\end{figure}

Figure~\ref{fig:mitmpoc} shows the overall architecture with an MitM server as the central mediator.
All arrows represent the transfer of \OMMT objects via SCSCP.
Critically, the MitM server also implements alignments and uses them to convert between system dialects.

We have extended the \MMT system~\cite{Rabe:MAGMS13} with an SCSCP server/client so that it can receive objects from computation systems and generates calls to others.
For the \GAP server, we built on pre-existing \SCSCP support.
To obtain an \SCSCP server for \Singular, which does not have native \SCSCP support, we wrapped \Singular in a python script that includes the \lstinline|pyscscp| library~\cite{py-scscp:on}.
In \Sage, we directly programmed the client interface to the MitM server. 

The resulting system forms the nucleus of the OpenDreamKit interoperability layer. It can already delegate computations between the three participating system  as long as they are covered by the MitM ontology, the alignments, and the system APIs. 

\paragraph{Case Study: Jane's Example} 

Initially, Jane has already built in \Sage the ring $R=\mathbb{Z}[X_1,X_2,X_3,X_4]$, the group $G=D_4$, and the action $A$ of $G$ on $R$ that permutes the variables, and the polynomial $p = 3\cdot X_1 + 2\cdot X_2$.  She now calls \lstinline|MitM.Singular(MitM.Gap.orbit(G, A, p)).Ideal().Groebner().sage()|, which results in the following steps (the numbers on the edges indicate the order of communications when processing Jane's use case):
\begin{compactenum}
  \item Jane uses \Sage to call the MitM server with the respective \Sage object, along with metadata about which system should be used for which computation.
  \item The MitM server translates \lstinline|MitM.Gap.orbit(G, A, p)| to the \GAP system dialect and sends it to \GAP.
  \item \GAP returns the orbit $O$.
  \item The MitM server translates \lstinline|MitM.Singular(O).Ideal().Groebner()| to the \Singular system dialect and sends it to \Singular.
  \item \Singular returns the Gröbner base $B$.
  \item The MitM server translates $B$ to the \Sage system dialect and sends it to \Sage, where the result is shown to Jane.
\end{compactenum}

\paragraph{Another use-case}

Suppose Jon, one of Jane's colleagues prefers working in \GAP, and he wants to
compute the Galois group of the rational polynomial $p = x^5 - 2$. He discovers
the \GAP package \texttt{radiroot}, which promises this functionality, but
unfortunately the package does not work for this polynomial and thus \GAP alone
cannot solve Jon's problem.

Jon hears from Jane that he should use \Sage, because she knows it can compute Galois groups, so he tries calling \lstinline|G := MitM("Sage", "GaloisGroup",p)| in \GAP which gives him the desired Galois group as a \GAP permutation group.

Jon, being a proficient \GAP user, also knows that he can now install a \defemph{method} in \GAP by calling 
\begin{lstlisting}
InstallMethod(GaloisGroup, "for a polynomial", [IsUnivariatePolynomial], 
              p -> MitM("Sage", "GaloisGroup", p))
\end{lstlisting}
that will compute the Galois group of any rational polynomial transparently for him whenever he calls \lstinline|GaloisGroup| for a rational polynomial in \GAP. 
And thus a significant part of the 1800-line \lstinline|radiroot| package can be replaced by a few lines extension in GAP, taking advantage of the work of the \Sage community, and participating in any future improvements of \Sage. 
In fact Sage uses the PARI system -- another of the OpenDreamKit systems -- for the computation.  So in the future \GAP might directly delegate to PARI instead, bypassing the need of iterated translations.

% $p =x^4-x^3-x^2+x+1$ over $\mathbb{Q}$ would have D_8 as galois group again...

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "paper"
%%% End:

%  LocalWords:  sec:case fig:mitmpoc IanJucKoh:sdm14,MathHub:on summarize sec:cgt pyscscp vspace lstlisting
%  LocalWords:  twiesing:msc17 centering tikzinput gap_singular_mitm_fig lstinline emph
%  LocalWords:  py-scscp:on oldpart mathbb cdot cdot Groebner Gröbner radiroot jist
%  LocalWords:  GaloisGroup galois
