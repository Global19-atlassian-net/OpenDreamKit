\documentclass{deliverablereport}
\usepackage{pdfpages}

\usepackage[style=alphabetic,backend=bibtex]{biblatex}
\addbibresource{../../lib/kbibs/kwarcpubs.bib}
\addbibresource{../../lib/kbibs/extpubs.bib}
\addbibresource{../../lib/kbibs/kwarccrossrefs.bib}
\addbibresource{../../lib/kbibs/extcrossrefs.bib}
\addbibresource{../../lib/deliverables.bib}
%\addbibresource{../../lib/publications.bib}
\addbibresource{rest.bib}
% temporary fix due to http://tex.stackexchange.com/questions/311426/bibliography-error-use-of-blxbblverbaddi-doesnt-match-its-definition-ve
\makeatletter\def\blx@maxline{77}\makeatother

\deliverable{component-architecture}{scscp-sage}
\deliverydate{02/27/2017}
\duedate{02/27/2017 (Month 18)}
\def\pn{OpenDreamKit}
\author{ }

\begin{document}
\maketitle
%\input{abstract}
% TODO: update GitHub issue description
\strut\githubissuedescription
\newpage\tableofcontents\newpage

\section{Introduction}\label{intro}

{\sf SCSCP} stands for the 
{\bf Symbolic Computation Software Composability Protocol}
-- the remote procedure call framework by which different
software components (primarily mathematical software systems) 
may offer computational services to a variety of possible
clients, such as, for example:
\begin{itemize}
\item A computer algebra system (CAS) running on the same computer system or remotely
\item Another instance of the same CAS (in a parallel computing context)
\item A simplistic SCSCP client (e.g. C/C++/Python/etc. program) with a minimal 
SCSCP support needed for a particular application
\item An internet application providing user interface to the computational services
\item A Web server which passes on the same services as Web services to other applications
\item Cloud middleware
\end{itemize}
using the OpenMath encoding (see \url{http://www.openmath.org/})
both for the data and protocol instructions. 

SCSCP has been developed in the EU FP6 project 026133 
``SCIEnce -- Symbolic Computation Infrastructure for Europe''
(\url{http://www.symbolic-computing.org/}).
In the duration of the project (2006-2011) and subsequent
years, native implementations of SCSCP client and server appeared in
several CAS such as GAP, KANT, Macaulay2, Maple, Mathematica, MuPAD
and TRIP; furthermore, APIs for Java, C and C++ were developed
to facilitate SCSCP implementations in other applications
(see the full list and links at \url{http://www.symbolic-computing.org/}).
However, there were no Python implementations of OpenMath and SCSCP 
(except a prototype quality client supporting only lists of integers)
and that hindered further extension of the SCSCP framework.

In this report we give an overview of work under the task T3.2 
to support SCSCP in all relevant components, necessary to be able
to build interfaces between different systems. 


\section{Systems}\label{systems}

Under the task T3.2, our goal is to make SCSCP-compliant all
relevant components. Since SCSCP is a protocol in which 
both data and instructions are encoded in OpenMath, its
implementation is typically split into two components: 
\begin{itemize}
\item OpenMath support to be able to parse and 
generate OpenMath code and encode/decode mathematical objects
\item client and server functionality needed to establish connection
and exchange with procedure calls and their results.
\end{itemize}

In order to achieve maximal impact on the Python ecosystem, 
instead of implementing SCSCP directly in SageMath, our approach
was to provide independent Python libraries, which may be used not
only in SageMath but also in a number of other Python applications
including scientific computing libraries such as e.g. 
SciPy, NumPy, SymPy etc.



\subsection{Python, SageMath and its components}

OpenMath and SCSCP support in Python is provided by two libraries, 
{\sf openmath} and {\sf scscp}, which are available from PyPI at
\url{https://pypi.python.org/pypi/openmath/} and
\url{https://pypi.python.org/pypi/scscp/} and
may be installed using the standard {\sf pip} installer 
both under Python 2 and Python 3. The development repositories
and issue trackers for these packages are hosted on GitHub
at \url{https://github.com/OpenMath/py-openmath}
and \url{https://github.com/OpenMath/py-scscp}.

TODO: Ask Luca for more detailed overview of the design of 
\url{https://github.com/OpenMath/py-scscp} 
and \url{https://github.com/OpenMath/py-openmath}. 

Explain how the user can now use these packages to extend supported OpenMath CDs
or use private encodings and implement own remote procedures.

TODO: Appendix with READMEs from \url{https://github.com/OpenMath/py-scscp}
and \url{https://github.com/OpenMath/py-openmath}. The latter should have
some more detailed README.

What other systems are doing? Because SageMath interfaces them, to offer them
as remote services, the SCSCP server can be run in SageMath, and Sage may be
also an SCSCP client, so can steer computation talking to e.g. remote GAP 
via SCSCP and local PARI/GP or Singular via its own interface.

We provide more details and examples of usage for the SCSCP client and server in
Python in Appendices. Examples of of Python 2, Python 3 and SageMath clients 
communicating with a GAP server are shown in Appendices \ref{python2-to-GAP},
\ref{python3-to-GAP} and \ref{SageMath-to-GAP} respectively.


\subsection{GAP}

OpenMath and SCSCP support in GAP is provided by two similarly named GAP packages, 
{\sf OpenMath} and {\sf SCSCP}. These packages are included in the 
standard GAP distribution and are also available from their 
websites:
\begin{itemize}
\item
\url{https://gap-packages.github.io/openmath/}
\item
\url{https://gap-packages.github.io/scscp/}
\end{itemize}
The development repositories and issue trackers for these packages are hosted on GitHub:
\begin{itemize}
\item
\url{https://github.com/gap-packages/openmath}
\item
\url{https://github.com/gap-packages/scscp}
\end{itemize}
Both packages have an extensive (20 and 54 pages respectively) documentation 
which is included in their distribution and is also available online:
\begin{itemize}
\item
\url{https://gap-packages.github.io/openmath/doc/chap0.html}
\item
\url{https://gap-packages.github.io/scscp/doc/chap0.html}
\end{itemize}

The GAP package OpenMath provides an OpenMath phrasebook for GAP.
It can import and export mathematical objects encoded in OpenMath
for the purpose of exchanging them with other OpenMath-enabled 
applications. It supports both XML and binary OpenMath encodings, 
and allows users to extend it to support private OpenMath content
dictionaries in case when the official OpenMath content dictionaries
do not exist or provide too verbose and inefficient encoding.

The SCSCP package implements SCSCP client and server. 
The client is capable of establishing the connection with the specified server
at the specified port; sending the {\tt procedure\_call} message to
the server in both blocking and non-blocking moders; and fetching
response in the form of the {\tt procedure\_completed} or
{\tt procedure\_terminated} message. 

The server reads all declarations from the specification file and starts
to listen to the specified port (by default port 26133). Upon receiving 
and incoming connection, it starts the ``receive-evaluate-return'' loop:
receive the {\tt procedure\_call} message; evaluate the result 
(or produce a side-effect); return the result in the form of the
{\tt procedure\_completed} message, or returns an error in the form
of {\tt procedure\_terminated} message.

The ability to issue non-blocking procedure calls and collect their result
later permitted to build a framework for distributed parallel computations
using the ``master-worker'' skeleton.

During the reported period, we have prepared new versions of 
both packages and migrated their development repositories and
websites to host them under the GAP packages virtual organisation 
on GitHub (see \url{https://gap-packages.github.io/}).
Their new versions are now picked up for the redistribution
with GAP and will appear in the next GAP release. Major changes
were upgrades and compatibility fixes for next GAP releases, 
and improvements to improve the security and robustness when
running public SCSCP servers. 

TODO: release GAP 4.8.7 by the end of February?

Several examples of using GAP SCSCP client and server are given
in the next section and Appendices. TODO: Cross-ref to appendides
and refer to other ODK workpackages (Docker, databases).


\subsection{MMT/MathHub}

TODO: Ask Tom to provide a description


\section{Examples}\label{examples}

TODO: introduction to this section. 

TODO: reorder? some examples may be incorporated 
into appropriate Systems (sub)sections. However, there
are cross-system examples too, and that's why they are
placed outside Systems section.

\subsection{GAP SCSCP server in Docker container}\label{gap-docker}

A very efficient and secure way to run public GAP SCSCP
server is to run it in the GAP Docker container. 
We have established a pipeline of GAP Docker containers
under the Task T3.1 (see \url{https://hub.docker.com/u/gapsystem/})
to serve different use cases, and the one which i most
suited for the SCSCP server is the {\tt gapsystem/gap-docker} 
container available at \url{https://hub.docker.com/r/gapsystem/gap-docker/} and
providing the most complete installation
of the GAP system and all of the more than 130 packages
currently redistributed with GAP, with satisfied dependencies
on the external software libraries.

If the SCSCP server configuration file {\tt myserver.g} is 
contained, for example, in the directory {\tt path}, 
then one could mount that directory as {\tt /scscp/} on the
container and start the GAP SCSCP server as follows:

{\tiny{\tt docker run --rm -i -t --net="host" -v path:/scscp gapsystem/gap-docker gap /scscp/myserver.g}}

A copy of the page \url{https://hub.docker.com/r/gapsystem/gap-docker/}
with detailed instructions on using the GAP Docker container 
is provided in Appendix \ref{SCSCP-with-GAP-docker}.


\subsection{The database of numbers of isomorphism
types of finite groups}\label{gnu-reproducibility}

One of SCSCP use cases is accessing large and/or frequently updated
databases, which should be rather accessed online that redistributed as
add-ons for mathematical software packages. Appendix \ref{Gnu-SCSCP-server}
contains a description of a proof-of-concept example how such access may
be organised to provide a crowdsourced database of numbers of isomorphism
types of finite groups (see  \url{https://github.com/alex-konovalov/gnu}). 

Using SCSCP, contributors may be able to get the latest information of 
known and unknown entries from the server, which runs in the GAP Docker 
container (see \ref{gap-docker}).


\subsection{SageMath}

TODO: brief description, and reference to the appendix, extend examples


\subsection{Singular}

TODO: Sebastian?


\subsection{PARI/GP}

TODO: Via SageMath?
% http://doc.sagemath.org/html/en/reference/interfaces/sage/interfaces/gp.html


\subsection{Parallel search in the GAP Small Groups Library using SCSCP}

Appendix \ref{Parallel-GAP-SCSCP} contains a quick start guide for setting
up the environment for parallel search in the GAP Small Groups Library. This
guide and supplementary files could be found at \url{https://github.com/alex-konovalov/scscp-demo}. The example used in this guide is based on the GAP Software Carpentry
lesson (\url{http://alex-konovalov.github.io/gap-lesson/}). This material was
included in the programme of two CoDiMa training schools in Computational
Discrete Mathematics held in the UK in 2015 and 2016
(\url{http://www.codima.ac.uk/schools/}).


\section{Future work}

Dissemination: reach out to SciPy, SymPy, NumPy communities.

Under the ODK project, we transferred SCSCP specification
to OpenMath society and licensed it under
W3C Software and document notice and license.

Make a proper webpage for SCSCP under OpenMath VO, with
PDFs of the specification and links to existing implementations.
TODO: give URLs of the new SCSCP website and repository.



\printbibliography

\appendix

\section{Example: SCSCP client in Python2 connecting to GAP server}\label{python2-to-GAP}
\includepdf[pages=-,scale=0.9,pagecommand={}]{examples/Python2-to-GAP.pdf}

\section{Example: SCSCP client in Python3 connecting to GAP server}\label{python3-to-GAP}
\includepdf[pages=-,scale=0.9,pagecommand={}]{examples/Python3-to-GAP.pdf}

\section{Example: SCSCP client in SageMath connecting to GAP server}\label{SageMath-to-GAP}
\includepdf[pages=-,scale=0.9,pagecommand={}]{examples/SageMath-to-GAP.pdf}

\section{Example: SCSCP client in GAP connecting to Python 3 server}\label{GAP-to-Python3numpy}
\includepdf[pages=-,scale=0.9,pagecommand={}]{examples/GAP-to-Python3numpy.pdf}

\section{Documentation for the GAP Docker container}\label{SCSCP-with-GAP-docker}
\includepdf[pages=-,scale=0.8,pagecommand={}]{examples/SCSCP-with-GAP-docker.pdf}

\section{Documentation for the GAP SCSCP server for the number of isomorphism types of groups of order $n$}\label{Gnu-SCSCP-server}
\includepdf[pages=-,scale=0.9,pagecommand={}]{examples/Gnu-SCSCP-server.pdf}

\section{Parallel search in the GAP Small Groups Library with SCSCP}
\label{Parallel-GAP-SCSCP}
\includepdf[pages=-,scale=0.9,pagecommand={}]{examples/Parallel-GAP-SCSCP.pdf}

\end{document}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: t
%%% End:

%  LocalWords:  githubissuedescription newpage tableofcontents newpage printbibliography
