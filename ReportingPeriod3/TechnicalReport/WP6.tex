\subsubsection{WorkPackage 6:  Data/Knowledge/Software-Bases}\label{dksbases}
%Explain, task per task, the work carried out in WP during the reporting period giving details of the work carried out by each beneficiary involved.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\paragraph{Overview}

In a series of workshops (September 2015 in Paris, January 2016 in St. Andrews, June 2016 in Bremen, and July 2016 in Bia{\l}ystok, 2017 in Orsay, 2018 in Cernay, 2019 in Cernay), the participants working on \WPref{dksbases} met and discussed the topic of integrating the \pn systems into a mathematical VRE toolkit.
Additionally, Florian Rabe was employed at both FAU and UPSud throughout 2018 and 2019 to deepen the integration.

Key results of the first two reporting periods were
\begin{compactitem}[\bf R1.]
\item the observation that \emph{knowledge-aware interoperability of software and database-systems is the most critical objective} for \WPref{dksbases} in the \pn project.
\item the consensus that this can be achieved by \emph{aligning the mathematical knowledge underlying the various systems},
\item the existing integration of mathematical computation systems in the Sage and Jupyter systems must be complemented with a similar integration of mathematical databases.
\end{compactitem}
This requires explicitly representing the three aspects of math VREs -- Data (D), Knowledge (K), and Software (S) -- and basing computational services and inter-system communication on a joint \DKS-base.
These results are engrained in the ``Math-in-the-Middle'' (MitM) paradigm~\cite{DehKohKon:iop16}, which gives a representational basis for specification-based interoperability of mathematical software systems -- so that they can be integrated in a VRE toolkit.
In the MitM paradigm, the mathematical knowledge underlying the VREs (K) and the interface for each system (S) are represented as modular theory graphs in the OMDoc/MMT format.
For the data aspect (D) we have extended the concept of OMDoc/MMT theories to ``virtual theories'' that allow the practical management of possibly infinite theories, see~\cite{ODK-D6.5} for details.

Through the concerted effort of the WP6 participants, we have been able to implement this design and instantiate itwith generate theory graphs for the \GAP and \Sage systems and integrating the \LMFDB (see~\cite{ODK-D6.5}.
Based on this, we were able to generically integrate \GAP, \Sage, and \LMFDB via the standardised SCSCP protocol~\cite{HorRoz:ossp09}. This case study shows the feasibility of the design. 

\begin{wrapfigure}r{6cm}\vspace*{-1em}
\input{../../WP6/D6.10/tetrapod-arms}\vspace*{.5em}
\caption{Five Aspects of Math VREs, a Tetrapod Structure}\label{fig:tetrapod}\vspace*{-1.5em}
\end{wrapfigure}
In the \textbf{third reporting period}, the focus was on the \textbf{representation and curation of mathematical data}, building on the earlier work. We have refined the original notion of \DKS-bases from the grant proposal into a tetrapodal structure which joins four primary aspects of ``doing Maths'' which have to be supported in a VRE toolkit via a modular organization aspect -- see the introduction  of \cite{ODK-D6.10} and \cite{CarFarKohRab:bmobb19} for a discussion.

We have taken up the general discussion of research data, the FAIR principles and have adapted them to the case of mathematical resarch data. The outcome of this was the concept that -- as mathematics deals with ideal and abstract objects -- it is possible to fully describe the objects in question symbolically and often losslessly represent them as database structures while at the same time binding them to the symbolic description. The codecs from the ``virtual theories'' approach developed in \WPref{dksbases} do just this: they link the database level of mathematical data sets with the MitM ontology -- and from there via the interface theory graphs interface it to the mathematical software systems in \pn.

We undertook three larger case studies to bring this about:
\begin{itemize}
\item Developing the system data.mathhub.info for managing mathematical data sets MitM-style and equipping it with a search UI; see the report on \taskref{dksbases}{data-LMFDB} below
\item Exporting a the Isabelle knowledge base (via a subcontract), and equipping it with a semantic search facility;  see the report on \taskref{dksbases}{isabelle} below 
\item Extending the formula search capabilities developed in the first reporting period to Jupyter notebooks; see the repoet on
 \taskref{dksbases}{mws} below.
\end{itemize}
This wraps up and integrates the work in \WPref{dksbases} combining aspects of Data (D), Knowledge (K), and Software (S). The joint system addreasses central aspects of all four FAIR concerns for research data semanticaly. 
For a joint and integrated final report on this, see ~\cite{ODK-D6.10}.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
\paragraph{Milestones}

% month 36
\subparagraph{\longmilestoneref{dksbases-interop1}}
This milestone was addressed in the second reporting period.
\medskip
%\emph{“User story: thanks to a fully functional prototype integrating of at least the systems \GAP, \Sage, \Singular, and \LMFDB via the \SCSCP Protocol, end users shall be able to run calculations involving any combination of those systems from any of them.
%  This prototype will be the basis for integration work for additional systems and the user interface from WP4.”}
%\medskip
%
%Workpackage \textbf{WP6} is fully on track with this milestone.
%After first integration and DKS prototypes (the MitM VRE middleware  framework) became available in late fall 2017 (see~\cite{KohMuePfe:kbimss17,WieKohRab:vtuimkb17}) we were able to develop more sophisticated -- and mathematically more realistic/relevant -- use cases~\cite{CreLow:mdcmds18} and generalize those parts of the framework that had been overly specific to the first use cases.
%This involved non-trivial investments in all parts of the framework, as well as the system API theory generation systems and (in particular) the MitM ontology. 

% month 42
\subparagraph{\longmilestoneref{dksbases-interop2}}
\begin{oldpart}{copied from TR 2, needs update by FAU}
\emph{“The goal of this milestone is to take into account all the operational experiences with the first prototype and add more systems and integrate some of the UI components from WP4.
  The experiences with the preparation of this prototype will allow us to estimate the joining costs of adding a system to the OpenDreamKit VRE toolkit, which is an important measure of the flexibility of the Math-In-the-Middle approach.”}
The state of the MitM VRE middleware is sufficiently mature that most of the functionality can be configured by writing domain and system knowledge in form of OMDoc/MMT theories, but not extending the system (programming the VRE systems or the MMT mediator).
This means that additional systems can be added at the cost of generating system API theories, extending the  MitM ontology and supplying alignments.
We are targeting the knowledge bases OEIS, and FindStat (see \localtaskref{dksbases}{data-findstat}) as well as PARI/GP.
We plan to extend the worked use cases substantially.
To this end we already have statements of interest from external researchers, who want to use the flexible integration in the MitM framework and do not mind the communication overheads involved. 
First work on UI integration work has already begun; see  \longdelivref{UI}{jupyter-import}, which presents a Jupyter kernel for MMT and prototypical MitM-based integration of Jupyter widgets.
\end{oldpart}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
\paragraph{Tasks}
\medskip

\subparagraph{\longtaskref{dksbases}{data-assessment}}
\label{dksbases@data-assessment}
This task was addressed in the first reporting period.
\medskip

\subparagraph{\longtaskref{dksbases}{data-triform}}
\label{dksbases@data-triform}
This task was addressed in the first reporting period.
%For this task we have specified and implemented the concept of virtual theories that can contain large -- theoretically even infinite -- numbers of declarations and objects (e.g. 3.5M declarations in the LMFDB data base for elliptic functions) in OMDoc/MMT.
%Virtual theories are characterized by the fact that they are too large to keep in main memory of the MMT System and have to be partially and lazily imported from an external data store.
%We have reported on the design in \longdelivref{dksbases}{design}, on a first implementation on the international conference (MACIS 2017)~\cite{WieKohRab:vtuimkb17}, and finally on an extended use-case in \LMFDB in \longdelivref{dksbases}{psfoundation}. 
\medskip

\subparagraph{\longtaskref{dksbases}{data-design}}
\label{dksbases@data-design}
This task was addressed in the first reporting period.
%This task was directly addressed in the \WPref{dksbases} workshops in the first year and has led to the design and implementation in \delivref{dksbases}{design}. A first implementation has been presented on the international conference (MACIS 2017)~\cite{WieKohRab:vtuimkb17}, and finally on an extended use-case in \LMFDB in \longdelivref{dksbases}{psfoundation}.
% \medskip

\subparagraph{\longtaskref{dksbases}{data-foundationCAS}}
\label{dksbases@data-foundationCAS}
This task was addressed in the first reporting period.
%In the course of the deliberations in the \WPref{dksbases} workshops we saw a shift from the development of computational foundations and verification towards API/Interface function specifications to enable semantic system interoperability via the Math-in-the-Middle (MitM) Ontology.
%Consequently, emphasis has changed to the generation of system API theories for \GAP, \Sage, \Singular, and \LMFDB, which act as OpenMath content dictionaries.
%The computational foundations exist but are rather more simple than originally anticipated.
%Much of the functionality has been offloaded to the SCSCP standard -- remote procedure call with OpenMath representations of the mathematical objects -- developed in the SCIENCE Project.
%As a direct consequence of the work in \pn the OpenMath Society has promoted the \SCSCP protocol into as an OpenMath Standard.
%
%Conversely, the \GAP and \Sage CDs are rather more elaborated than anticipated in the proposal, and thus form a viable basis for alignment with the MitM Ontology.
%
%The MitM integration paradigm is the result of our research and development on the computer algebra foundations in this task has been presented on the international conference MACIS 2017~\cite{KohMuePfe:kbimss17} and is described in deliverable \longdelivref{dksbases}{psfoundation}, which presents an advanced CAS integration use case. 
%The MitM ontology and the system API theories have been developed to the point, where the data model is fully developed and the contents cover the use cases corresponding to this task and \longlocaltaskref{dksbases}{data-design} are surveyed in \longdelivref{dksbases}{lfmverif}.
\medskip

\subparagraph{\longtaskref{dksbases}{research-categories}}
\label{dksbases@data-research-categories}

\begin{oldpart}{this is the text from TR 2, update by FAU needed}
The MitM architecture developed in \WPref{dksbases} has given important impulses to make the code infrastructure of \Sage and \GAP more declarative (knowledge-based).
In \Sage, the category infrastructure was validated (it seems to be the right level of abstraction to generate API theories) and extended; we explore ways to enrich it with additional semantic
trough the use of annotations, to maximize the chance of
them being accepted and adopted by the Sage community.

In \GAP, the facilities for ``constructors'' was reformed, extended by an infrastructure for documentation and static typing/type analysis, and the code base refactored for over 2000 constructors.
Similarly, the online documentation subsystem for \GAP has been regularized and synchronized with the constructor level.
Already at this early stage of the task the new ``knowledge-based perspective'' has revealed a plethora of errors and inefficiencies and has contributed to the code quality in both systems.
\end{oldpart}
\medskip

\subparagraph{\longtaskref{dksbases}{data-OEIS}}
\label{dksbases@data-OEIS}
This task was addressed in the first reporting period.
%For the OEIS case study we have parsed the OEIS data and converted it into OMDoc/MMT theories (ca. 260,000).
%The main problem solved here was to parse the formula section (generating functions, relations between sequences, \ldots): they are represented in a human-oriented ASCII syntax, which is highly irregular, ill-separated from surrounding text, and interpunctuation.
%Nonetheless we managed to recover ca. 90\% of the formulae and
%\begin{compactenum}[\em i\rm)]
%\item generate ca. 100,000 new relations between sequences and
%\item provide a package of ca. 50,000 generating functions to Sage (which can be used
%  e.g. in the FindStat database).
%\end{compactenum}
%We use this theory set to test the functionalities of ``virtual theory graphs'' (one step up from the ``virtual theories'' developed in \localtaskref{dksbases}{data-design}).
\medskip

\subparagraph{\longtaskref{dksbases}{data-findstat}}
\label{dksbases@data-findstat}
This task was addressed in the second reporting period.
%We have seen that the \LMFDB already shows all the complexities needed to develop full-coverage DKS functionality for the \pn VRE toolkit.
%On the other hand our survey shows that our DKS design (OMDoc/MMT virtual theories) is sufficient for covering the FindStat use case as well.
%Therefore we have delayed this taks to the last year of the \pn project, when the system API theories for \Sage and OEIS have matured. With the declarative design of the virtual theories, task \localtaskref{dksbases}{data-findstat} becomes a matter of writing down the schema theories system API theories for FindStat and defining the requisite codecs. We expect this to be a matter of one of two weeks of joint development of the FAU team together with UPSud. 
\medskip

\subparagraph{\longtaskref{dksbases}{data-LMFDB}}
\label{dksbases@data-LMFDB}

\begin{oldpart}{this is the text from TR 2, update by FAU needed}
Work on this task has started. Given the concept of virtual theories developed in \localtaskref{dksbases}{data-triform} the task is to build a database connector that converts the MongoDB tables in LMFDB into ``mathematical objects''.
We have identified the problems -- e.g. that objects are reduced to ad-hoc database records: for instance elliptic curves are represented as a quadruple of integers, where the last is represented as a string of digits as the range of MongoDB integers is too small.
We have developed an architecture of language-specific Codecs which mitigate these problems in a knowledge-centered way (Codecs are OMDoc/MMT objects) that interpret database records as OMDoc/MMT objects and can thus be used populate virtual theories.
The next step is to extend the existing MMT query language by a query compiler into the underlying data store system; concretely to MongoDB underlying LMFDB for \localtaskref{dksbases}{data-LMFDB}.
\end{oldpart}
\medskip

\subparagraph{\longtaskref{dksbases}{data-memo}}
\label{dksbases@data-memo}
We have developed persistent memoization modules for Sage and Gap that can use both local and remote data stores.
Both use the same format so they can share the same data stores.\ednote{to be finished by sites US,PS,UW}

We report on this task in detail in \delivref{dksbases}{persistent-memoization}.
\medskip

\subparagraph{\longtaskref{dksbases}{mws}}
\begin{oldpart}{this is the text from TR 2, update by FAU needed}
Work on the first work phase has proceeded as planned and has culminated in \longdelivref{dksbases}{mws}.
The second work phase on this task presupposes the Math-in-the-Middle ontology (as we call it now.)
Where we already have that, e.g. for the OEIS (see \localtaskref{dksbases}{data-OEIS}) we already have a running search engine.
The main problem here is to devise intuitive query interfaces and integrate them into the \pn VRE framework.
\end{oldpart}

We report on this task in detail in \delivref{dksbases}{nbad-search}.
\medskip

\subparagraph{\longtaskref{dksbases}{isabelle}}
\begin{newpart}{FR: adapted from the deliverable}
For many decades, the development of a universal database of all mathematical knowledge, as envisioned, e.g., in the QED manifesto \cite{qed}, has been a major driving force of computer mathematics.
Today a variety of such libraries are available.
These are most prominently developed in proof assistants such as Coq \cite{coq} or Isabelle \cite{isabelle} and are treasure troves of detailed mathematical knowledge.
Within \pn, we have developed interface standards, specifically OMDoc for symbolic and ULO for relational knowledge, that allow maintainers of formal libraries to make their content available to outside systems.

In this task (which has been added in the last amendment of the grant agreement), we have exported the large Isabelle knowledge bases as both OMDoc/MMT and ULO format
Concretely, we have built an exporter from the Isabelle Theorem prover library (Archive of Formal Proof) to both MMT and RDF data.
This exporter is now part of the latest releases of both Isabelle and MMT, and the exported data is available online.

We report on this task in detail in \delivref{dksbases}{nbad-search}.
\end{newpart}


%%% Local Variables:
%%% mode: latex 
%%% mode: visual-line
%%% fill-column: 5000
%%% TeX-master: "report"
%%% End:

%  LocalWords:  subsubsection dksbases ystok WPref compactitem emph DehKohKon:iop16 textbf taskref longdelivref lfmverif triformal formalized biformal HorRoz:ossp09 medskip longmilestoneref dksbases-interop1 dksbases-interop2 characterized WieKohRab:vtuimkb17 psfoundation delivref KohMuePfe:kbimss17 regularized synchronized ldots interpunctuation compactenum mws KohMuePfe:kbimss17,WieKohRab:vtuimkb17 CreLow:mdcmds18 jupyter-import Jupyter MitM-based Jupyter
